<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consulta Stock Chapas</title>

<style>

body{
font-family: Arial;
background: linear-gradient(135deg,#667eea,#764ba2);
color:white;
margin:0;
padding:20px;
}

h1{
text-align:center;
}

.filtros{
background:white;
color:black;
padding:15px;
border-radius:8px;
margin-bottom:15px;
display:flex;
flex-wrap:wrap;
gap:10px;
}

input,select{
padding:6px;
font-size:14px;
}

table{
width:100%;
border-collapse:collapse;
background:white;
color:black;
}

th{
background:#333;
color:white;
padding:8px;
cursor:pointer;
}

td{
padding:6px;
border-bottom:1px solid #ddd;
}

tr:hover{
background:#f0f0f0;
}

</style>
</head>

<body>

<h1>Consulta Inventario Chapas</h1>

<div class="filtros">

<input id="busquedaGlobal" placeholder="Buscar cualquier valor..." oninput="filtrar()">

<input id="fLargo" placeholder="Largo" oninput="filtrar()">

<input id="fAncho" placeholder="Ancho" oninput="filtrar()">

<input id="fEspesor" placeholder="Espesor" oninput="filtrar()">

<select id="fAleacion" onchange="filtrar()">
<option value="">Todas Aleaciones</option>
</select>

<select id="fTemple" onchange="filtrar()">
<option value="">Todos Temples</option>
</select>

<input id="precioKilo" placeholder="Precio €/kg" oninput="filtrar()">

</div>

<table id="tabla">

<thead>

<tr>

<th onclick="ordenar('REFERENCIA')">Referencia</th>

<th onclick="ordenar('Largo')">Largo</th>

<th onclick="ordenar('Ancho')">Ancho</th>

<th onclick="ordenar('Espesor')">Espesor</th>

<th onclick="ordenar('Aleación')">Aleación</th>

<th onclick="ordenar('Temple')">Temple</th>

<th onclick="ordenar('Peso Teórico')">Peso Teórico</th>

<th onclick="ordenar('Precio')">Precio €</th>

</tr>

</thead>

<tbody></tbody>

</table>

<script>

let datos=[];
let datosFiltrados=[];
let direccionOrden=1;

fetch('./inventario.json?v='+Date.now())

.then(r=>r.json())

.then(json=>{

datos=json;

datosFiltrados=json;

llenarCombos();

mostrar(datos);

});

function llenarCombos(){

let aleaciones=[...new Set(datos.map(x=>x["Aleación"]).filter(x=>x))];

let temples=[...new Set(datos.map(x=>x["Temple"]).filter(x=>x))];

let selAleacion=document.getElementById("fAleacion");

let selTemple=document.getElementById("fTemple");

aleaciones.sort().forEach(x=>{

let o=document.createElement("option");
o.value=x;
o.text=x;
selAleacion.add(o);

});

temples.sort().forEach(x=>{

let o=document.createElement("option");
o.value=x;
o.text=x;
selTemple.add(o);

});

}

function mostrar(lista){

let precioKilo=parseFloat(document.getElementById("precioKilo").value)||0;

let tbody=document.querySelector("#tabla tbody");

tbody.innerHTML="";

lista.forEach(x=>{

let precio=(precioKilo*x["Peso Teórico"]).toFixed(2);

let tr=document.createElement("tr");

tr.innerHTML=`

<td>${x["REFERENCIA"]||""}</td>

<td>${x["Largo"]||""}</td>

<td>${x["Ancho"]||""}</td>

<td>${x["Espesor"]||""}</td>

<td>${x["Aleación"]||""}</td>

<td>${x["Temple"]||""}</td>

<td>${x["Peso Teórico"]||""}</td>

<td>${precio}</td>

`;

tbody.appendChild(tr);

});

}

function filtrar(){

let global=document.getElementById("busquedaGlobal").value.toLowerCase();

let largo=document.getElementById("fLargo").value.toLowerCase();

let ancho=document.getElementById("fAncho").value.toLowerCase();

let espesor=document.getElementById("fEspesor").value.toLowerCase();

let aleacion=document.getElementById("fAleacion").value.toLowerCase();

let temple=document.getElementById("fTemple").value.toLowerCase();

datosFiltrados=datos.filter(x=>{

let texto=JSON.stringify(x).toLowerCase();

return(

(!global||texto.includes(global))&&

(!largo||String(x["Largo"]).toLowerCase().includes(largo))&&

(!ancho||String(x["Ancho"]).toLowerCase().includes(ancho))&&

(!espesor||String(x["Espesor"]).toLowerCase().includes(espesor))&&

(!aleacion||String(x["Aleación"]).toLowerCase().includes(aleacion))&&

(!temple||String(x["Temple"]).toLowerCase().includes(temple))

);

});

mostrar(datosFiltrados);

}

function ordenar(col){

direccionOrden*=-1;

datosFiltrados.sort((a,b)=>{

let v1=a[col]||"";
let v2=b[col]||"";

if(!isNaN(v1)&&!isNaN(v2)){

return direccionOrden*(v1-v2);

}

return direccionOrden*v1.toString().localeCompare(v2.toString());

});

mostrar(datosFiltrados);

}

</script>

</body>

</html>
