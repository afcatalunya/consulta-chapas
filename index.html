<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consulta Inventario Chapas</title>

<style>

body{
    font-family: Arial;
    background: linear-gradient(135deg,#6a8cff,#8a5fd1);
    color:white;
    margin:0;
    padding:20px;
}

.container{
    background:white;
    color:black;
    padding:20px;
    border-radius:10px;
}

input,select,button{
    padding:6px;
    margin:5px;
}

table{
    width:100%;
    border-collapse:collapse;
}

th,td{
    padding:8px;
    border:1px solid #ccc;
}

th{
    background:#333;
    color:white;
}

.stock{
    color:green;
    font-weight:bold;
}

.sin-stock{
    color:red;
    font-weight:bold;
}

.pedido{
    color:orange;
    font-weight:bold;
}

.precio{
    font-weight:bold;
    color:#0066cc;
}

</style>
</head>

<body>

<div class="container">

<h2>Consulta Inventario Chapas</h2>

<div>

Precio €/kg:
<input id="precioKilo" type="number" step="0.01" placeholder="Ej: 2.45" oninput="mostrar(datos)">

<br>

Largo:
<input id="fLargo">

Ancho:
<input id="fAncho">

Espesor:
<input id="fEspesor">

Aleación:
<select id="fAleacion">
<option value="">Todas</option>
</select>

Temple:
<select id="fTemple">
<option value="">Todos</option>
</select>

<button onclick="filtrar()">Buscar</button>

</div>

<br>

<table id="tabla">

<thead>

<tr>

<th>Referencia</th>
<th>Descripción</th>
<th>Largo</th>
<th>Ancho</th>
<th>Espesor</th>
<th>Aleación</th>
<th>Temple</th>
<th>Peso teórico (kg)</th>
<th>Precio</th>
<th>Estado</th>

</tr>

</thead>

<tbody></tbody>

</table>

</div>

<script>

let datos=[];

fetch("./inventario.json?v="+Date.now())
.then(r=>r.json())
.then(json=>{

datos=json;

llenarCombos();

mostrar(datos);

})
.catch(err=>{

document.body.innerHTML="<h2 style='color:red'>Error cargando datos</h2>";

});

function llenarCombos(){

let aleaciones=[...new Set(datos.map(x=>x["Aleación"]).filter(x=>x))];
let temples=[...new Set(datos.map(x=>x["Temple"]).filter(x=>x))];

let a=document.getElementById("fAleacion");
let t=document.getElementById("fTemple");

aleaciones.sort().forEach(v=>{
let o=document.createElement("option");
o.value=v;
o.text=v;
a.appendChild(o);
});

temples.sort().forEach(v=>{
let o=document.createElement("option");
o.value=v;
o.text=v;
t.appendChild(o);
});

}

function calcularEstado(x){

let murcia=x["MURCIA"]||0;
let tarragona=x["TARRAGONA"]||0;
let valencia=x["VALENCIA"]||0;
let pedidas=x["PEDIDAS"]||0;

let total=murcia+tarragona+valencia;

if(total>0)
return {texto:"STOCK",clase:"stock"};

if(pedidas>0)
return {texto:"PEDIDO",clase:"pedido"};

return {texto:"SIN STOCK",clase:"sin-stock"};

}

function calcularPrecio(x){

let precioKilo=parseFloat(document.getElementById("precioKilo").value);

if(!precioKilo)
return "";

let peso=x["Peso Teórico"];

if(!peso)
return "";

let precio=precioKilo*peso;

return precio.toFixed(2)+" €";

}

function mostrar(lista){

let tbody=document.querySelector("#tabla tbody");

tbody.innerHTML="";

lista.forEach(x=>{

let estado=calcularEstado(x);

let precio=calcularPrecio(x);

let tr=document.createElement("tr");

tr.innerHTML=`

<td>${x["REFERENCIA"]||""}</td>

<td>${x["Descripción"]||""}</td>

<td>${x["Largo"]||""}</td>

<td>${x["Ancho"]||""}</td>

<td>${x["Espesor"]||""}</td>

<td>${x["Aleación"]||""}</td>

<td>${x["Temple"]||""}</td>

<td>${x["Peso Teórico"]||""}</td>

<td class="precio">${precio}</td>

<td class="${estado.clase}">${estado.texto}</td>

`;

tbody.appendChild(tr);

});

}

function filtrar(){

let largo=document.getElementById("fLargo").value;
let ancho=document.getElementById("fAncho").value;
let espesor=document.getElementById("fEspesor").value;
let aleacion=document.getElementById("fAleacion").value;
let temple=document.getElementById("fTemple").value;

let res=datos.filter(x=>

(!largo || x["Largo"]==largo)
&&
(!ancho || x["Ancho"]==ancho)
&&
(!espesor || x["Espesor"]==espesor)
&&
(!aleacion || x["Aleación"]==aleacion)
&&
(!temple || x["Temple"]==temple)

);

mostrar(res);

}

</script>

</body>
</html>


