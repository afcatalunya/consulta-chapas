<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Inventario - Aluminios Franco Catalu√±a</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #366092;
        }
        
        .header h1 {
            color: #366092;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: #366092;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #366092;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .price-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .price-section label {
            font-weight: bold;
            font-size: 1.2em;
            color: #366092;
        }
        
        .price-section input {
            padding: 12px 20px;
            border: 3px solid #366092;
            border-radius: 8px;
            font-size: 1.2em;
            width: 180px;
            font-weight: bold;
        }
        
        .price-section input:focus {
            outline: none;
            border-color: #2a4d73;
            box-shadow: 0 0 10px rgba(54, 96, 146, 0.3);
        }
        
        .filters {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .filters h2 {
            color: #366092;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .filter-item input,
        .filter-item select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .filter-item input:focus,
        .filter-item select:focus {
            outline: none;
            border-color: #366092;
        }
        
        .btn-clear {
            background: #dc3545;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }
        
        .btn-clear:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .stat-box .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .stat-box .label {
            font-size: 1em;
            opacity: 0.95;
        }
        
        .table-container {
            overflow: auto;
            max-height: 650px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        thead {
            background: #366092;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 0.95em;
            white-space: nowrap;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
        }
        
        tbody tr {
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: #f5f5f5;
        }
        
        .warning {
            background: #fff3cd !important;
            border-left: 5px solid #ff6b6b;
        }
        
        .warning:hover {
            background: #ffe8a1 !important;
        }
        
        .badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            display: inline-block;
            white-space: nowrap;
        }
        
        .badge-stock { background: #28a745; color: white; }
        .badge-7-10 { background: #17a2b8; color: white; }
        .badge-pendiente { background: #ffc107; color: #333; }
        .badge-sin-stock { background: #dc3545; color: white; }
        .badge-bajo { background: #ff9800; color: white; }
        
        .info-text {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.95em;
        }
        
        .price-column {
            font-weight: bold;
            color: #28a745;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <h2>Cargando inventario...</h2>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <h1>üìã Consulta de Inventario de Chapas</h1>
            <div class="subtitle">Aluminios Franco Catalu√±a</div>
        </div>

        <div class="price-section">
            <label for="precioKilo">üí∞ Precio por Kilo (‚Ç¨):</label>
            <input type="number" id="precioKilo" value="2.50" step="0.01" min="0">
            <span style="color: #666;">Los precios se actualizan autom√°ticamente</span>
        </div>

        <div class="filters">
            <h2>üîç Filtros de B√∫squeda</h2>
            <div class="filter-grid">
                <div class="filter-item">
                    <label>Largo (mm)</label>
                    <input type="text" id="fLargo" placeholder="Ej: 2000">
                </div>
                <div class="filter-item">
                    <label>Ancho (mm)</label>
                    <input type="text" id="fAncho" placeholder="Ej: 1000">
                </div>
                <div class="filter-item">
                    <label>Espesor (mm)</label>
                    <input type="text" id="fEspesor" placeholder="Ej: 1.5">
                </div>
                <div class="filter-item">
                    <label>Aleaci√≥n</label>
                    <select id="fAleacion">
                        <option value="">Todas</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>Temple</label>
                    <select id="fTemple">
                        <option value="">Todos</option>
                    </select>
                </div>
            </div>
            <button class="btn-clear" onclick="limpiarFiltros()">üîÑ Limpiar Filtros</button>
            <div class="info-text">
                üí° Los resultados se filtran autom√°ticamente mientras escribes
            </div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="number" id="numResultados">0</div>
                <div class="label">Resultados</div>
            </div>
            <div class="stat-box">
                <div class="number" id="numExistencias">0</div>
                <div class="label">Existencias Totales</div>
            </div>
            <div class="stat-box">
                <div class="number" id="numAvisos">0</div>
                <div class="label">‚ö†Ô∏è Stock Bajo</div>
            </div>
            <div class="stat-box">
                <div class="number" id="valorTotal">0 ‚Ç¨</div>
                <div class="label">Valor Total</div>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Ref</th>
                        <th>Descripci√≥n</th>
                        <th>Largo</th>
                        <th>Ancho</th>
                        <th>Espesor</th>
                        <th>Aleaci√≥n</th>
                        <th>Temple</th>
                        <th>Peso (kg)</th>
                        <th>Precio Unit.</th>
                        <th>Pedidas</th>
                        <th>Exist.</th>
                        <th>Murcia</th>
                        <th>Tarrag.</th>
                        <th>Valenc.</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let datos = [];
        let datosFiltrados = [];

        // Cargar el JSON autom√°ticamente
        fetch('inventario.json')
            .then(response => response.json())
            .then(data => {
                datos = data;
                datosFiltrados = datos;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                
                inicializarApp();
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loading').innerHTML = '<h2 style="color: red;">Error al cargar los datos</h2>';
            });

        function inicializarApp() {
            llenarSelectores();
            configurarEventos();
            mostrarDatos();
        }

        function llenarSelectores() {
            const aleaciones = [...new Set(datos.map(d => d.Aleaci√≥n).filter(a => a))].sort();
            const selAl = document.getElementById('fAleacion');
            selAl.innerHTML = '<option value="">Todas</option>';
            aleaciones.forEach(a => {
                selAl.innerHTML += `<option value="${a}">${a}</option>`;
            });

            const temples = [...new Set(datos.map(d => d.Temple).filter(t => t))].sort();
            const selTe = document.getElementById('fTemple');
            selTe.innerHTML = '<option value="">Todos</option>';
            temples.forEach(t => {
                selTe.innerHTML += `<option value="${t}">${t}</option>`;
            });
        }

        function configurarEventos() {
            document.getElementById('fLargo').addEventListener('input', filtrar);
            document.getElementById('fAncho').addEventListener('input', filtrar);
            document.getElementById('fEspesor').addEventListener('input', filtrar);
            document.getElementById('fAleacion').addEventListener('change', filtrar);
            document.getElementById('fTemple').addEventListener('change', filtrar);
            document.getElementById('precioKilo').addEventListener('input', mostrarDatos);
        }

        function filtrar() {
            const largo = document.getElementById('fLargo').value.trim();
            const ancho = document.getElementById('fAncho').value.trim();
            const espesor = document.getElementById('fEspesor').value.trim();
            const aleacion = document.getElementById('fAleacion').value;
            const temple = document.getElementById('fTemple').value;

            datosFiltrados = datos.filter(item => {
                if (largo && String(item.Largo) !== largo) return false;
                if (ancho && String(item.Ancho) !== ancho) return false;
                if (espesor && String(item.Espesor) !== espesor) return false;
                if (aleacion && item.Aleaci√≥n !== aleacion) return false;
                if (temple && item.Temple !== temple) return false;
                return true;
            });

            mostrarDatos();
        }

        function calcularEstado(murcia, tarragona, valencia, existencias, pedidas) {
            if (tarragona >= 10) {
                return '<span class="badge badge-stock">STOCK</span>';
            }
            if (murcia >= 10 || valencia >= 10) {
                return '<span class="badge badge-7-10">7/10 D√çAS</span>';
            }
            if (existencias === 0 && pedidas > 0) {
                return '<span class="badge badge-pendiente">PENDIENTE RECEPCI√ìN</span>';
            }
            if (existencias === 0) {
                return '<span class="badge badge-sin-stock">SIN STOCK</span>';
            }
            if (existencias < 10) {
                let estado = `<span class="badge badge-bajo">‚ö†Ô∏è BAJO (${existencias})</span>`;
                if (pedidas > 0) {
                    estado += ` <span class="badge badge-pendiente">${pedidas} PED.</span>`;
                }
                return estado;
            }
            return '<span class="badge badge-7-10">7/10 D√çAS</span>';
        }

        function mostrarDatos() {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';

            const precioKilo = parseFloat(document.getElementById('precioKilo').value) || 0;
            let totalExist = 0;
            let numAvisos = 0;
            let valorTotal = 0;

            datosFiltrados.forEach(item => {
                const tr = document.createElement('tr');
                
                const exist = item['Existencias Totales'] || 0;
                const pedidas = item.PEDIDAS || 0;
                const murcia = item.MURCIA || 0;
                const tarra = item.TARRAGONA || 0;
                const valen = item.VALENCIA || 0;
                const peso = item['Peso Te√≥rico'] || 0;
                const precio = peso * precioKilo;

                totalExist += exist;
                valorTotal += precio * exist;

                if (exist < 10) numAvisos++;

                const estado = calcularEstado(murcia, tarra, valen, exist, pedidas);

                if (exist < 10) tr.className = 'warning';

                tr.innerHTML = `
                    <td>${item.REFERENCIA || ''}</td>
                    <td>${item.Descripci√≥n || ''}</td>
                    <td>${item.Largo || ''}</td>
                    <td>${item.Ancho || ''}</td>
                    <td>${item.Espesor || ''}</td>
                    <td>${item.Aleaci√≥n || ''}</td>
                    <td>${item.Temple || ''}</td>
                    <td style="text-align:center">${peso.toFixed(2)}</td>
                    <td class="price-column" style="text-align:center">${precio.toFixed(2)} ‚Ç¨</td>
                    <td style="text-align:center">${pedidas}</td>
                    <td style="text-align:center"><b>${exist}</b></td>
                    <td style="text-align:center">${murcia}</td>
                    <td style="text-align:center">${tarra}</td>
                    <td style="text-align:center">${valen}</td>
                    <td>${estado}</td>
                `;

                tbody.appendChild(tr);
            });

            document.getElementById('numResultados').textContent = datosFiltrados.length;
            document.getElementById('numExistencias').textContent = totalExist.toLocaleString();
            document.getElementById('numAvisos').textContent = numAvisos;
            document.getElementById('valorTotal').textContent = valorTotal.toLocaleString('es-ES', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' ‚Ç¨';
        }

        function limpiarFiltros() {
            document.getElementById('fLargo').value = '';
            document.getElementById('fAncho').value = '';
            document.getElementById('fEspesor').value = '';
            document.getElementById('fAleacion').value = '';
            document.getElementById('fTemple').value = '';
            filtrar();
        }
    </script>
</body>
</html>
